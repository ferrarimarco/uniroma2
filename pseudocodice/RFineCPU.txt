* DESCRIZIONE PROCEDURA < Fine CPU >;
PROCEDURE Fine CPU;
BEGIN

	< esamino classe JOB J uscente >;

	* GESTIONE JOB USCENTE CLASSE 1
	IF < classe J == 1 >
	THEN
		BEGIN
		* DECIDO CLASSE JOB
		< calcolo prob per decidere classe di J >;
		IF < prob <= 0.3 >
			THEN
			< J diventa di classe 2 >;
		ELSE
			< J diventa di classe 3 >;

		IF < CPU libera >
			THEN
			< inserisci J in CPU >;
			
			* AGGIORNAMENTO CALENDARIO
			< prevedi durata Tcpu(J) del servizio cpu >;
			< aggiorno calendario tcpu := clock + Tcpu(J) >;
		ELSE
			< inserisci J in codaCpu >;
		
		END

	* GESTIONE JOB USCENTE CLASSE 2 o 3
	ELSE
		BEGIN
		< esamino stato JOB J >;
		IF < classe J == 2 >
			THEN
			BEGIN
				* INVIO A HOST
				< prossima unità NX(J) = HOST per J >;
				< occupa Host con J >;
				
				* AGGIORNAMENTO CALENDARIO
				< prevedi durata Thost(J) del servizio host >;
				< aggiorno calendario thost := clock + Thost(J) >;
			END
		ELSE IF < classe J == 3 >
			THEN
			BEGIN
				< calcolo prob per instradamento di J >;
				IF < prob <= 0.1 >
					THEN
					BEGIN
						* INVIO A STAMPANTE
						< prossima unità NX(J) = ST per J >;
						< occupa ST con J >;
					
						* AGGIORNAMENTO CALENDARIO
						< prevedi durata Tst(J) del servizio ST >;
						< aggiorno calendario tst := clock + Tst(J) >;
					END
				ELSE
					BEGIN
						IF < DISK libero >
							THEN
							* MEMORIZZA ISTANTE DI ENTRATA JOB IN DISK PER CALCOLO THROUGHPUT
							* NON SERVE < istante di entrata J in DISK := clock >;
							
							< occupo DISK con J >;
							
							* AGGIORNAMENTO CALENDARIO
							< prevedi Tdisk(J) servizio DISK >;
							< tdisk:= clock + Tdisk(J) >;	
						ELSE
							< inserisco J in codaDisk >;
					END
			END
			
			
		END

	* GESTIONE JOB ENTRANTI

	* SCELGO PROSSIMO JOB DA CODA (FIFO)
	< esamino stato coda >;

	IF <code vuote>
	   THEN
		< libera CPU >; 
	ELSE
		BEGIN
	   		< introduci nuovo J in CPU >;
	   		
	   		* AGGIORNAMENTO CALENDARIO
			< prevedi durata Tcpu(J) del servizio cpu >;
			< aggiorno calendario tcpu := clock + Tcpu(J) >;
	   END
END
   
